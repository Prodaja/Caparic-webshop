<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Caparicki webshop</title>
  <meta name="description" content="Caparicki webshop – Natin, Ikanov, Milin i Lukin ducan :)(squishy)."/>

  <style>
    :root{
      --bg0:#060817;
      --bg1:#0b1130;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.11);
      --stroke: rgba(255,255,255,.14);
      --text:#f3f5ff;
      --muted: rgba(243,245,255,.78);
      --shadow: 0 18px 55px rgba(0,0,0,.45);

      --p1:#7c5cff;
      --p2:#34d399;
      --p3:#ff6bd6;
      --p4:#ffd166;
      --p5:#4dd3ff;
      --radius: 22px;

      --good:#34d399;
      --warn:#ffd166;
      --bad:#ff6b6b;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 900px at 10% -10%, rgba(124,92,255,.35), transparent 60%),
        radial-gradient(900px 650px at 90% 0%, rgba(52,211,153,.25), transparent 60%),
        radial-gradient(900px 650px at 50% 120%, rgba(255,107,214,.18), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* floating blobs */
    .blob{
      position:fixed; z-index:-1; filter: blur(18px);
      opacity:.65; border-radius: 999px;
      animation: floaty 10s ease-in-out infinite;
    }
    .b1{ width:320px;height:320px; left:-80px; top:120px; background: rgba(255,107,214,.35); }
    .b2{ width:360px;height:360px; right:-120px; top:180px; background: rgba(77,211,255,.30); animation-duration: 12s;}
    .b3{ width:420px;height:420px; left:35%; bottom:-200px; background: rgba(52,211,153,.25); animation-duration: 14s;}
    @keyframes floaty{
      0%,100%{ transform: translateY(0) translateX(0) scale(1); }
      50%{ transform: translateY(-18px) translateX(14px) scale(1.05); }
    }

    .wrap{max-width:1120px;margin:0 auto;padding:18px 16px 30px;}

    /* Topbar */
    .topbar{
      position:sticky; top:12px; z-index:20;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 14px;
      border-radius: 26px;
      background: rgba(12,16,44,.55);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:0}
    .logo{
      width:44px;height:44px;border-radius:16px; position:relative; flex:0 0 auto;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.75), transparent 42%),
        conic-gradient(from 210deg, var(--p1), var(--p2), var(--p3), var(--p5), var(--p1));
      box-shadow: 0 18px 44px rgba(124,92,255,.35);
    }
    .logo:after{
      content:""; position:absolute; inset:11px;
      border-radius:12px; background: rgba(6,8,23,.55);
      border:1px solid rgba(255,255,255,.12);
    }
    .brand h1{margin:0;font-size:15px;font-weight:1000;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand small{display:block;margin-top:2px;color:var(--muted);font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .right{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      font-weight:950;
      user-select:none;
    }
    .count{
      padding:2px 10px;border-radius:999px;
      background: rgba(124,92,255,.25);
      border:1px solid rgba(124,92,255,.55);
    }

    .btn{
      border:0; cursor:pointer; user-select:none;
      padding:10px 12px;border-radius:16px;
      font-weight:1000;
      color:#08102a;
      background: linear-gradient(135deg, var(--p2), #a6ffd8);
      box-shadow: 0 16px 44px rgba(52,211,153,.18);
      transition: transform .12s ease, filter .12s ease;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .btn.secondary{
      color: var(--text);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
    }

    /* Hero */
    .hero{
      margin-top:14px;
      border-radius: 32px;
      padding:18px;
      background:
        radial-gradient(900px 380px at 15% 20%, rgba(124,92,255,.22), transparent 60%),
        radial-gradient(900px 380px at 85% 30%, rgba(52,211,153,.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){ .heroGrid{grid-template-columns:1fr} }
    .hero h2{
      margin:0 0 8px 0;
      font-size: 30px;
      line-height:1.05;
      letter-spacing:.2px;
      font-weight:1100;
    }
    .hero p{
      margin:0;
      color: var(--muted);
      font-weight:800;
      line-height:1.45;
      font-size: 14.5px;
    }

    .stickers{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .sticker{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight:1000;
      font-size: 12px;
    }
    .dot{width:10px;height:10px;border-radius:50%;}
    .d1{background: var(--p4); box-shadow:0 0 0 6px rgba(255,209,102,.12)}
    .d2{background: var(--p3); box-shadow:0 0 0 6px rgba(255,107,214,.12)}
    .d3{background: var(--p2); box-shadow:0 0 0 6px rgba(52,211,153,.12)}

    .panel{
      border-radius: 26px;
      padding:14px;
      background: rgba(12,16,44,.55);
      border:1px solid rgba(255,255,255,.12);
      position:relative;
      overflow:hidden;
    }
    .panel .shine{
      position:absolute; inset:-80px -80px auto auto;
      width:220px;height:220px;border-radius:50%;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.6), rgba(255,255,255,0) 55%);
      opacity:.25;
      transform: rotate(25deg);
    }

    /* Progress / Level */
    .xpBox{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    .lvlRow{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:12px; border-radius:18px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
    }
    .lvlLeft b{font-size:13px;font-weight:1200}
    .lvlLeft div{color:var(--muted); font-weight:950; font-size:12px; margin-top:4px}
    .lvlBadge{
      padding:8px 10px; border-radius:999px;
      background: rgba(124,92,255,.25);
      border:1px solid rgba(124,92,255,.55);
      font-weight:1200; font-size:12px;
      white-space:nowrap;
    }
    .bar{
      height:12px;border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
    }
    .bar > i{
      display:block; height:100%;
      width:20%;
      background: linear-gradient(90deg, var(--p2), var(--p5), var(--p1));
      border-radius:999px;
      transition: width .25s ease;
    }

    .lesson{
      margin-top:10px;
      padding:12px; border-radius:18px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(243,245,255,.88);
      font-weight:900;
      line-height:1.35;
      font-size:12.5px;
    }
    .lesson b{color:#fff}
    .lesson .tag{
      display:inline-flex; align-items:center; gap:8px;
      margin-top:8px;
      padding:7px 10px; border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      font-weight:1100;
      font-size:11px;
      color: var(--muted);
    }
    .tagGood{border-color: rgba(52,211,153,.35); color: rgba(52,211,153,.95)}
    .tagWarn{border-color: rgba(255,209,102,.35); color: rgba(255,209,102,.95)}
    .tagBad{border-color: rgba(255,107,107,.35); color: rgba(255,107,107,.95)}

    /* Controls */
    .controls{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.3fr 1fr auto;
      gap:10px;
    }
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline:none;
      font-weight:900;
    }
    input::placeholder{color: rgba(243,245,255,.70); font-weight:800}
    @media (max-width: 900px){ .controls{grid-template-columns:1fr} }

    /* Grid */
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns: repeat(2, 1fr)} }
    @media (max-width: 520px){ .grid{grid-template-columns: 1fr} }

    .card{
      border-radius: var(--radius);
      overflow:hidden;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
      transition: transform .12s ease, border-color .12s ease;
      position:relative;
    }
    .card:hover{transform: translateY(-2px); border-color: rgba(124,92,255,.42)}
    .img{
      height: 170px;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.55), transparent 45%),
        linear-gradient(135deg, rgba(124,92,255,.28), rgba(52,211,153,.22));
      display:flex; align-items:center; justify-content:center;
      position:relative;
    }
    .img img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.08) contrast(1.03)}
    .ph{
      padding:8px 10px;border-radius:999px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(255,255,255,.9);
      color: rgba(6,8,23,.92);
      font-weight:1100;
      letter-spacing:.3px;
    }
    .badgeCorner{
      position:absolute; top:10px; left:10px;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(6,8,23,.35);
      backdrop-filter: blur(8px);
      font-weight:1100;
      font-size: 11px;
    }

    .c{padding:12px}
    .row{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
    .name{margin:0; font-size:14px; font-weight:1100; line-height:1.15}
    .desc{margin:8px 0 10px 0; color: var(--muted); font-weight:850; font-size:12.5px; line-height:1.35}
    .price{font-weight:1200; font-size:15px}
    .actions{display:flex; gap:10px; margin-top:10px}
    .add{
      flex:1;
      border:0; cursor:pointer;
      padding:10px 12px;border-radius:16px;
      font-weight:1200;
      color:#070a16;
      background: linear-gradient(135deg, var(--p1), var(--p3));
      box-shadow: 0 16px 40px rgba(124,92,255,.16);
      transition: transform .12s ease, filter .12s ease;
    }
    .add:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .details{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;border-radius:16px;
      cursor:pointer;
      font-weight:1100;
    }

    /* Drawer cart */
    .backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      z-index:50;
    }
    .drawer{
      position:fixed; top:0; right:0; height:100%;
      width:min(420px, 92vw);
      background: rgba(10,14,34,.96);
      border-left:1px solid rgba(255,255,255,.14);
      box-shadow: -18px 0 60px rgba(0,0,0,.35);
      transform: translateX(105%);
      transition: transform .18s ease;
      z-index:60;
      display:flex; flex-direction:column;
    }
    .drawer.open{transform: translateX(0)}
    .dhead{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px;
      border-bottom:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
    }
    .x{
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      font-weight:1100;
    }
    .items{padding:12px; overflow:auto; flex:1}
    .item{
      display:grid; grid-template-columns: 54px 1fr auto;
      gap:10px; align-items:center;
      padding:10px; border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      margin-bottom:10px;
    }
    .mini{
      width:54px;height:54px;border-radius:16px; overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:center;
      font-weight:1100; color: rgba(243,245,255,.80);
    }
    .mini img{width:100%;height:100%;object-fit:cover;display:block}
    .ititle{font-weight:1100; font-size:13px; margin:0 0 4px 0}
    .iprice{color: var(--muted); font-weight:950; font-size:12px}
    .qty{display:flex; align-items:center; gap:8px; justify-content:flex-end}
    .qbtn{
      width:32px;height:32px;border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      font-weight:1200;
    }
    .sum{
      padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
    }
    .sumrow{display:flex; justify-content:space-between; align-items:center; margin:8px 0}
    .sumrow span{color: var(--muted); font-weight:1100}
    .checkout{
      width:100%;
      border:0; cursor:pointer;
      padding:12px 14px;border-radius:18px;
      font-weight:1200;
      color:#070a16;
      background: linear-gradient(135deg, var(--p2), #a6ffd8);
      margin-top:10px;
    }
    .note{margin:10px 0 0; color: rgba(243,245,255,.75); font-weight:850; font-size:12px; line-height:1.35}

    /* Modal details */
    .modalbg{
      position:fixed; inset:0;
      background: rgba(0,0,0,.60);
      display:none; align-items:center; justify-content:center;
      padding:16px; z-index:70;
    }
    .modal{
      width:min(860px, 100%);
      border-radius: 26px;
      background: rgba(10,14,34,.96);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .mhead{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px;
      border-bottom:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
    }
    .mbody{
      display:grid; grid-template-columns: 1fr 1fr;
      gap:14px; padding:14px;
    }
    @media (max-width: 820px){ .mbody{grid-template-columns:1fr} }
    .mimg{
      height:280px;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:center;
    }
    .mimg img{width:100%;height:100%;object-fit:cover;display:block}
    .minfo{
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      padding:12px;
    }
    .minfo h3{margin:0 0 6px 0; font-weight:1200}
    .meta{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 10px 0}
    .pill{
      font-size:11px; font-weight:1100;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
    }

    /* Mascots */
    .mascotWrap{display:flex; gap:10px; align-items:center; justify-content:flex-end; flex-wrap:wrap}
    .mascot{
      width:96px; height:72px; flex:0 0 auto;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
      animation: bop 1.6s ease-in-out infinite;
    }
    .mascot:nth-child(2){animation-delay:.2s}
    .mascot:nth-child(3){animation-delay:.4s}
    @keyframes bop{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-2px)}
    }

    .footer{
      margin:18px 0 6px;
      text-align:center;
      color: rgba(243,245,255,.70);
      font-weight:850;
      font-size:12px;
    }

    /* Confetti */
    .confetti{
      position:fixed; inset:0; pointer-events:none; z-index:80;
      overflow:hidden; display:none;
    }
    .confetti i{
      position:absolute; width:10px; height:14px; border-radius:4px;
      opacity:.95;
      animation: fall 900ms linear forwards;
      transform: translateY(-20px) rotate(0deg);
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(420deg); opacity:1; }
    }

    /* Toast */
    .toastHost{
      position:fixed; z-index:90; right:14px; bottom:14px;
      display:flex; flex-direction:column; gap:10px;
      pointer-events:none;
    }
    .toast{
      pointer-events:none;
      width:min(380px, 92vw);
      border-radius:18px;
      padding:12px 12px;
      background: rgba(10,14,34,.92);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 55px rgba(0,0,0,.38);
      transform: translateY(10px);
      opacity:0;
      animation: toastIn 220ms ease forwards;
    }
    @keyframes toastIn{
      to{transform: translateY(0); opacity:1}
    }
    .toastTop{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .toastTitle{font-weight:1200}
    .toastBody{margin-top:6px; color:rgba(243,245,255,.82); font-weight:900; line-height:1.35; font-size:12.5px}
    .toastPill{
      font-size:11px; font-weight:1200;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      white-space:nowrap;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .blob,.mascot{animation:none}
      .card:hover,.btn:hover,.add:hover{transform:none}
    }
  </style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1 id="shopName">Caparicki webshop</h1>
          <small id="shopSub">Za klince • Squishy • Nauči kako radi trgovina</small>
        </div>
      </div>

      <div class="right">
        <div class="chip" title="Broj proizvoda u korpi">
          Korpa <span class="count" id="cartCount">0</span>
        </div>
        <button class="btn secondary" id="openCart">Otvori korpu</button>
      </div>
    </header>

    <section class="hero">
      <div class="heroGrid">
        <div>
          <h2>Caparicki webshop: <br/>klikni, izaberi, nauči.</h2>
          <p>
            Ovo je edukativni mini-shop: učiš šta je proizvod, cena, korpa i porudžbina.
            Nema kartica i nema pravog plaćanja — porudžbina ide roditelju kao poruka.
          </p>

          <div class="stickers">
            <span class="sticker"><span class="dot d1"></span> Igrica mod</span>
            <span class="sticker"><span class="dot d2"></span> Level up</span>
            <span class="sticker"><span class="dot d3"></span> Mobile friendly</span>
          </div>

          <div class="controls" style="margin-top:14px;">
            <input id="q" placeholder="Pretraga (npr. kapibara, donut, boba)" />
            <select id="sort">
              <option value="popular">Sort: preporučeno</option>
              <option value="cheap">Cena: niža → viša</option>
              <option value="expensive">Cena: viša → niža</option>
              <option value="name">Naziv: A → Z</option>
            </select>
            <button class="btn" id="scrollShop">Ponuda</button>
          </div>
        </div>

        <div class="panel">
          <div class="shine" aria-hidden="true"></div>

          <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px;">
            <div style="font-weight:1100;">Tvoj napredak</div>
            <div class="mascotWrap" aria-label="Crtani likovi">
              <div class="mascot" title="Kapibara">
                <svg viewBox="0 0 160 120" width="96" height="72" aria-hidden="true">
                  <defs><linearGradient id="g1" x1="0" x2="1">
                    <stop offset="0" stop-color="#7c5cff"/><stop offset="1" stop-color="#ff6bd6"/>
                  </linearGradient></defs>
                  <rect x="0" y="0" width="160" height="120" rx="26" fill="rgba(255,255,255,.03)"/>
                  <circle cx="56" cy="58" r="28" fill="url(#g1)"/>
                  <circle cx="100" cy="58" r="28" fill="#34d399" opacity=".9"/>
                  <circle cx="68" cy="56" r="8" fill="#fff"/>
                  <circle cx="92" cy="56" r="8" fill="#fff"/>
                  <circle cx="70" cy="58" r="3" fill="#0b1130"/>
                  <circle cx="94" cy="58" r="3" fill="#0b1130"/>
                  <path d="M78 74c8 8 16 8 24 0" stroke="#0b1130" stroke-width="6" stroke-linecap="round" fill="none"/>
                  <circle cx="44" cy="40" r="6" fill="#ffd166"/>
                  <circle cx="116" cy="40" r="6" fill="#4dd3ff"/>
                </svg>
              </div>
              <div class="mascot" title="Donut">
                <svg viewBox="0 0 160 120" width="96" height="72" aria-hidden="true">
                  <defs><linearGradient id="g2" x1="0" x2="1">
                    <stop offset="0" stop-color="#ffd166"/><stop offset="1" stop-color="#ff6bd6"/>
                  </linearGradient></defs>
                  <rect x="0" y="0" width="160" height="120" rx="26" fill="rgba(255,255,255,.03)"/>
                  <circle cx="80" cy="60" r="34" fill="url(#g2)"/>
                  <circle cx="80" cy="60" r="14" fill="rgba(10,14,34,.96)"/>
                  <circle cx="66" cy="56" r="6" fill="#fff"/>
                  <circle cx="94" cy="56" r="6" fill="#fff"/>
                  <circle cx="68" cy="58" r="2.5" fill="#0b1130"/>
                  <circle cx="96" cy="58" r="2.5" fill="#0b1130"/>
                  <path d="M68 76c8 6 16 6 24 0" stroke="#0b1130" stroke-width="6" stroke-linecap="round" fill="none"/>
                  <circle cx="52" cy="40" r="4" fill="#34d399"/>
                  <circle cx="104" cy="38" r="4" fill="#4dd3ff"/>
                  <circle cx="110" cy="78" r="4" fill="#7c5cff"/>
                  <circle cx="50" cy="80" r="4" fill="#ff6bd6"/>
                </svg>
              </div>
              <div class="mascot" title="Boba">
                <svg viewBox="0 0 160 120" width="96" height="72" aria-hidden="true">
                  <defs><linearGradient id="g3" x1="0" x2="1">
                    <stop offset="0" stop-color="#4dd3ff"/><stop offset="1" stop-color="#7c5cff"/>
                  </linearGradient></defs>
                  <rect x="0" y="0" width="160" height="120" rx="26" fill="rgba(255,255,255,.03)"/>
                  <rect x="54" y="28" width="52" height="66" rx="18" fill="url(#g3)"/>
                  <rect x="58" y="32" width="44" height="42" rx="14" fill="rgba(255,255,255,.35)"/>
                  <rect x="76" y="14" width="8" height="18" rx="4" fill="#ffd166"/>
                  <circle cx="68" cy="84" r="6" fill="#0b1130" opacity=".9"/>
                  <circle cx="80" cy="88" r="6" fill="#0b1130" opacity=".9"/>
                  <circle cx="92" cy="84" r="6" fill="#0b1130" opacity=".9"/>
                  <circle cx="72" cy="56" r="6" fill="#fff"/>
                  <circle cx="88" cy="56" r="6" fill="#fff"/>
                  <circle cx="74" cy="58" r="2.5" fill="#0b1130"/>
                  <circle cx="90" cy="58" r="2.5" fill="#0b1130"/>
                  <path d="M72 72c6 6 10 6 16 0" stroke="#0b1130" stroke-width="6" stroke-linecap="round" fill="none"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="xpBox">
            <div class="lvlRow">
              <div class="lvlLeft">
                <b>Nivo <span id="lvl">1</span> • XP <span id="xp">0</span>/<span id="xpNeed">100</span></b>
                <div id="badgeLine">Bedž: Početnik kupac</div>
              </div>
              <div class="lvlBadge" id="lvlBadge">POČETNIK</div>
            </div>
            <div class="bar" aria-label="XP bar"><i id="barFill"></i></div>

            <div class="lesson" id="lessonBox">
              <b>Mini lekcija:</b> Pre kupovine pitaj se: “Da li mi se samo sviđa ili mi stvarno treba?”
              <div class="tag tagGood">Tip: napravi mali budžet i drži ga se</div>
            </div>
          </div>

          <p class="note" style="margin-top:10px;">
            Ti menjaš samo slike, opise i cene u listi proizvoda. Sve ostalo radi samo.
          </p>
        </div>
      </div>
    </section>

    <div class="grid" id="grid"></div>

    <div class="footer">
      © <span id="year"></span> Caparicki webshop • Nata, Ikan, Mila i Luka
    </div>
  </div>

  <!-- Confetti -->
  <div class="confetti" id="confetti"></div>

  <!-- Toast -->
  <div class="toastHost" id="toastHost" aria-live="polite"></div>

  <!-- Backdrop + Drawer -->
  <div class="backdrop" id="backdrop"></div>
  <aside class="drawer" id="drawer" aria-label="Korpa">
    <div class="dhead">
      <b>Moja korpa</b>
      <button class="x" id="closeCart" aria-label="Zatvori">X</button>
    </div>

    <div class="items" id="cartItems"></div>

    <div class="sum">
      <div class="sumrow">
        <span>Ukupno</span>
        <b id="total">0 RSD</b>
      </div>
      <div class="sumrow">
        <span>Budžet</span>
        <b id="budgetLine">—</b>
      </div>
      <button class="checkout" id="checkoutBtn">Pošalji roditelju (WhatsApp)</button>
      <p class="note" id="budgetNote">
        Poruka sadrži listu proizvoda i ukupnu cenu. (Nema kartica i nema plaćanja na sajtu.)
      </p>
    </div>
  </aside>

  <!-- Modal -->
  <div class="modalbg" id="modalBg" aria-label="Detalji proizvoda">
    <div class="modal">
      <div class="mhead">
        <b>Detalji</b>
        <button class="x" id="closeModal" aria-label="Zatvori">X</button>
      </div>
      <div class="mbody">
        <div class="mimg" id="mimg"></div>
        <div class="minfo">
          <h3 id="mname">—</h3>
          <div class="meta" id="mmeta"></div>
          <p id="mdesc" style="margin:0;color:var(--muted);font-weight:900;line-height:1.45"></p>
          <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
            <button class="btn" id="madd">Dodaj u korpu</button>
            <button class="btn secondary" id="mclose2">Zatvori</button>
          </div>
          <p class="note" id="mLesson" style="margin-top:10px;">
            Mini lekcija: pre nego što dodaš, pitaj se — da li ti se sviđa, ili ti stvarno treba?
          </p>
        </div>
      </div>
    </div>
  </div>

<script>
/* =========================
   1) TI MENJAŠ OVO
   ========================= */
const SHOP_NAME = "Caparicki webshop";
const SHOP_SUB  = "Za klince • Squishy • Nauči kako radi trgovina";
const CURRENCY  = "RSD";

// Viber broj (bez +), npr. 3816xxxxxxx
const Viber_NUMBER = "381600000000";

// EDU: dnevni budžet (deca uče budžetiranje)
const BUDGET_RSD = 2000; // promeni (npr. 1000, 1500, 3000)

// PROIZVODI: ubaci slike i cene.
// Slike stavi u folder img/ (pored index.html), pa u img upiši npr: "img/kapibara.jpg"
const PRODUCTS = [
  { id:"kapibara", name:"Mini Kapibara", price: 790,  rarity:"Rare",   tag:"Hit", img:"img/kapibara.jpg", desc:"Mekana kapibara – savršena za stiskanje i opuštanje." },
  { id:"donut",    name:"Galaxy Donut",   price: 990,  rarity:"Epic",   tag:"Wow", img:"img/donut.jpg",    desc:"Šareni donut koji izgleda kao iz svemira." },
  { id:"boba",     name:"Boba Milk Tea",  price: 1190, rarity:"Epic",   tag:"Top", img:"img/boba.jpg",     desc:"Milk tea sa boba kuglicama — preslatko i cool." },
  { id:"panda",    name:"Panda Roll",     price: 850,  rarity:"Rare",   tag:"Kul", img:"",                desc:"Panda koja je uvek spremna za stiskanje." },
  { id:"cake",     name:"Jagoda Tortica", price: 1290, rarity:"Legend", tag:"Slatko", img:"",             desc:"Tortica sa jagodom — wow efekat za vitrinu." },
  { id:"rainbow",  name:"Rainbow Mačka",  price: 1390, rarity:"Legend", tag:"Šareno", img:"",             desc:"Duga-mačka. Kad je vidiš, moraš je imati." },
];

/* =========================
   2) LOGIKA (NE DIRAJ)
   ========================= */
const fmt = new Intl.NumberFormat("sr-RS", { style:"currency", currency: CURRENCY, maximumFractionDigits: 0 });

const state = {
  q:"",
  sort:"popular",
  cart: loadCart(),
  xp: loadNum("cap_xp", 0),
  level: loadNum("cap_lvl", 1),
  achievements: loadObj("cap_ach", {}),
  lastLessonIndex: loadNum("cap_lesson_i", 0)
};

function loadCart(){
  try { return JSON.parse(localStorage.getItem("cap_cart") || "{}"); }
  catch(e){ return {}; }
}
function loadNum(k, def){
  const v = Number(localStorage.getItem(k));
  return Number.isFinite(v) && v>=0 ? v : def;
}
function loadObj(k, def){
  try { return JSON.parse(localStorage.getItem(k) || JSON.stringify(def)); }
  catch(e){ return def; }
}
function saveAll(){
  localStorage.setItem("cap_cart", JSON.stringify(state.cart));
  localStorage.setItem("cap_xp", String(state.xp));
  localStorage.setItem("cap_lvl", String(state.level));
  localStorage.setItem("cap_ach", JSON.stringify(state.achievements));
  localStorage.setItem("cap_lesson_i", String(state.lastLessonIndex));
  updateCartCount();
  updateProgressUI();
}

/* ===== Lessons / Achievements ===== */
const LESSONS = [
  { title:"Mini lekcija", text:"Pre kupovine pitaj se: “Da li mi se samo sviđa ili mi stvarno treba?”", tag:["Tip: prespavaj 1 noć pa odluči", "good"] },
  { title:"Mini lekcija", text:"Budžet je plan: ako imaš 2.000 RSD, ne kupuješ za 2.500 RSD.", tag:["Tip: napravi listu želja", "warn"] },
  { title:"Mini lekcija", text:"Cena nije isto što i vrednost. Vrednost je: koliko ti znači + koliko ćeš koristiti.", tag:["Tip: pitaj: koliko puta ću koristiti?", "good"] },
  { title:"Mini lekcija", text:"Popust nije magija. Ako nešto ne bi kupio bez popusta, možda ti ne treba ni sa popustom.", tag:["Tip: uporedi pre i posle", "warn"] },
  { title:"Mini lekcija", text:"Račun (ukupno) = cena × količina. To je super moć za kupovinu.", tag:["Tip: izračunaj u glavi", "good"] },
];

const BADGES = [
  { lvl:1, name:"Početnik kupac", label:"POČETNIK" },
  { lvl:2, name:"Pametan izbor", label:"PAMETAN" },
  { lvl:3, name:"Šampion budžeta", label:"BUDŽET" },
  { lvl:4, name:"Trgovac pro", label:"PRO" },
  { lvl:5, name:"Legenda webshop-a", label:"LEGENDA" },
];

function xpNeedForLevel(lvl){
  // postepeno teže: 100, 140, 190, 250, ...
  return Math.round(80 + lvl*40 + (lvl-1)*(lvl*10));
}

function giveXP(amount, reason){
  const beforeLvl = state.level;
  state.xp += amount;

  let need = xpNeedForLevel(state.level);
  while(state.xp >= need){
    state.xp -= need;
    state.level += 1;
    need = xpNeedForLevel(state.level);
    popConfetti(26);
    toast("LEVEL UP!", `Bravo! Sada si nivo ${state.level}. Nastavi da skupljaš XP!`, `Nivo ${state.level}`);
    awardBadgeIfAny();
  }

  saveAll();

  if(reason){
    toast("+XP", `${reason} (+${amount} XP)`, "Napredak");
  }

  if(beforeLvl === state.level){
    // malo confetti i bez level up
    popConfetti(14);
  }
}

function awardOnce(key, title, text){
  if(state.achievements[key]) return;
  state.achievements[key] = true;
  popConfetti(34);
  toast(title, text, "Bedž");
  saveAll();
}

function awardBadgeIfAny(){
  const b = BADGES.slice().reverse().find(x => state.level >= x.lvl);
  if(!b) return;
  // bedž se prikazuje u UI, a “awardOnce” za milestone
  if(state.level === 2) awardOnce("lvl2","Bedž otključan!", "Pametan izbor: znaš da ne kupuješ impulsivno.");
  if(state.level === 3) awardOnce("lvl3","Bedž otključan!", "Šampion budžeta: razmišljaš o ukupnoj ceni.");
  if(state.level === 5) awardOnce("lvl5","Bedž otključan!", "Legenda webshop-a: znaš kako radi korpa i račun.");
}

function nextLesson(){
  state.lastLessonIndex = (state.lastLessonIndex + 1) % LESSONS.length;
  const L = LESSONS[state.lastLessonIndex];
  const box = document.getElementById("lessonBox");
  box.innerHTML = `<b>${L.title}:</b> ${L.text}
    <div class="tag ${L.tag[1]==="good"?"tagGood":L.tag[1]==="warn"?"tagWarn":"tagBad"}">${L.tag[0]}</div>`;
  saveAll();
}

/* ===== UI helpers ===== */
function toast(title, body, pill){
  const host = document.getElementById("toastHost");
  const t = document.createElement("div");
  t.className = "toast";
  t.innerHTML = `
    <div class="toastTop">
      <div class="toastTitle">${escapeHtml(title)}</div>
      <div class="toastPill">${escapeHtml(pill || "Info")}</div>
    </div>
    <div class="toastBody">${escapeHtml(body)}</div>
  `;
  host.appendChild(t);
  setTimeout(()=>{ t.style.opacity="0"; t.style.transform="translateY(10px)"; }, 2600);
  setTimeout(()=>{ t.remove(); }, 3000);
}

function popConfetti(pieces=18){
  const c = document.getElementById("confetti");
  c.innerHTML = "";
  c.style.display = "block";
  const colors = ["#7c5cff","#34d399","#ff6bd6","#ffd166","#4dd3ff"];
  for(let i=0;i<pieces;i++){
    const p = document.createElement("i");
    const left = Math.random()*100;
    const delay = Math.random()*120;
    const dur = 650 + Math.random()*520;
    const size = 7 + Math.random()*9;
    p.style.left = left+"vw";
    p.style.top = (-20 - Math.random()*80)+"px";
    p.style.width = size+"px";
    p.style.height = (size+4)+"px";
    p.style.background = colors[Math.floor(Math.random()*colors.length)];
    p.style.animationDuration = dur+"ms";
    p.style.animationDelay = delay+"ms";
    c.appendChild(p);
  }
  setTimeout(()=>{ c.style.display="none"; c.innerHTML=""; }, 1200);
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[s]));
}

/* ===== Product filtering/sorting ===== */
function filtered(){
  let list = PRODUCTS.slice();
  const s = state.q.trim().toLowerCase();
  if(s){
    list = list.filter(p =>
      p.name.toLowerCase().includes(s) ||
      (p.desc||"").toLowerCase().includes(s) ||
      (p.tag||"").toLowerCase().includes(s)
    );
  }
  if(state.sort === "cheap") list.sort((a,b)=>a.price-b.price);
  if(state.sort === "expensive") list.sort((a,b)=>b.price-a.price);
  if(state.sort === "name") list.sort((a,b)=>a.name.localeCompare(b.name,"sr"));
  return list;
}

/* ===== Render grid ===== */
function renderGrid(){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  const list = filtered();

  if(!list.length){
    const div = document.createElement("div");
    div.style.gridColumn="1/-1";
    div.style.padding="16px";
    div.style.border="1px solid rgba(255,255,255,.14)";
    div.style.borderRadius="22px";
    div.style.background="rgba(255,255,255,.05)";
    div.style.color="rgba(243,245,255,.85)";
    div.style.fontWeight="950";
    div.textContent="Nema rezultata. Probaj drugu pretragu.";
    grid.appendChild(div);
    return;
  }

  list.forEach(p=>{
    const card = document.createElement("div");
    card.className="card";

    const img = document.createElement("div");
    img.className="img";

    const corner = document.createElement("div");
    corner.className="badgeCorner";
    corner.textContent = p.tag || "Squishy";
    img.appendChild(corner);

    if(p.img){
      const im = document.createElement("img");
      im.src = p.img; im.alt = p.name;
      img.appendChild(im);
    } else {
      const ph = document.createElement("div");
      ph.className="ph";
      ph.textContent="UBACI SLIKU";
      img.appendChild(ph);
    }

    const c = document.createElement("div");
    c.className="c";

    const row = document.createElement("div");
    row.className="row";

    const name = document.createElement("h3");
    name.className="name";
    name.textContent = p.name;

    row.appendChild(name);

    const desc = document.createElement("div");
    desc.className="desc";
    desc.textContent = (p.desc||"").slice(0, 92) + ((p.desc||"").length>92 ? "…" : "");

    const price = document.createElement("div");
    price.className="price";
    price.textContent = fmt.format(p.price);

    const actions = document.createElement("div");
    actions.className="actions";

    const add = document.createElement("button");
    add.className="add";
    add.textContent="Dodaj";
    add.onclick = ()=> {
      addToCart(p.id,1);
      giveXP(xpFor(p), `Dodao si "${p.name}" u korpu`);
      eduCheckAfterAdd();
    };

    const details = document.createElement("button");
    details.className="details";
    details.textContent="Detalji";
    details.onclick = ()=> openModal(p.id);

    actions.appendChild(add);
    actions.appendChild(details);

    c.appendChild(row);
    c.appendChild(desc);
    c.appendChild(price);
    c.appendChild(actions);

    card.appendChild(img);
    card.appendChild(c);
    grid.appendChild(card);
  });
}

/* ===== XP points per item ===== */
function xpFor(p){
  const r = (p.rarity||"").toLowerCase();
  if(r.includes("legend")) return 24;
  if(r.includes("epic")) return 18;
  if(r.includes("rare")) return 14;
  return 10;
}

/* ===== Cart logic ===== */
function saveCart(){
  localStorage.setItem("cap_cart", JSON.stringify(state.cart));
  updateCartCount();
  updateBudgetUI();
}
function updateCartCount(){
  const count = Object.values(state.cart).reduce((a,b)=>a+b,0);
  document.getElementById("cartCount").textContent = count;
}
function addToCart(id, delta){
  state.cart[id] = (state.cart[id]||0) + delta;
  if(state.cart[id] <= 0) delete state.cart[id];
  saveCart();
  renderCart();
}
function removeFromCart(id){
  delete state.cart[id];
  saveCart();
  renderCart();
}
function cartTotal(){
  let total = 0;
  Object.entries(state.cart).forEach(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    total += p.price * qty;
  });
  return total;
}
function renderCart(){
  const box = document.getElementById("cartItems");
  box.innerHTML = "";
  const entries = Object.entries(state.cart);

  let total = 0;

  if(!entries.length){
    const empty = document.createElement("div");
    empty.style.padding="14px";
    empty.style.border="1px solid rgba(255,255,255,.14)";
    empty.style.borderRadius="18px";
    empty.style.background="rgba(255,255,255,.04)";
    empty.style.color="rgba(243,245,255,.88)";
    empty.style.fontWeight="950";
    empty.innerHTML = "Korpa je prazna. Dodaj nešto preslatko!";
    box.appendChild(empty);
    document.getElementById("total").textContent = fmt.format(0);
    updateBudgetUI();
    return;
  }

  entries.forEach(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    total += p.price * qty;

    const it = document.createElement("div");
    it.className="item";

    const mini = document.createElement("div");
    mini.className="mini";
    if(p.img){
      const im = document.createElement("img");
      im.src = p.img; im.alt = p.name;
      mini.appendChild(im);
    } else {
      mini.textContent="IMG";
    }

    const mid = document.createElement("div");
    const t = document.createElement("div");
    t.className="ititle";
    t.textContent=p.name;

    const pr = document.createElement("div");
    pr.className="iprice";
    pr.textContent = `${fmt.format(p.price)} • x${qty}`;

    mid.appendChild(t);
    mid.appendChild(pr);

    const q = document.createElement("div");
    q.className="qty";

    const minus = document.createElement("button");
    minus.className="qbtn";
    minus.textContent="–";
    minus.onclick=()=>{ addToCart(id,-1); giveXP(2,"Smanjio si količinu (pametan potez)"); eduCheckAfterAdd(); };

    const plus = document.createElement("button");
    plus.className="qbtn";
    plus.textContent="+";
    plus.onclick=()=>{ addToCart(id,+1); giveXP(4,"Povećao si količinu"); eduCheckAfterAdd(); };

    const del = document.createElement("button");
    del.className="qbtn";
    del.textContent="×";
    del.onclick=()=>{ removeFromCart(id); giveXP(6,"Obrisao si item — kontrola budžeta!"); eduCheckAfterAdd(); };

    q.appendChild(minus);
    q.appendChild(plus);
    q.appendChild(del);

    it.appendChild(mini);
    it.appendChild(mid);
    it.appendChild(q);

    box.appendChild(it);
  });

  document.getElementById("total").textContent = fmt.format(total);
  updateBudgetUI();
}

/* ===== Budget education ===== */
function updateBudgetUI(){
  const total = cartTotal();
  const line = document.getElementById("budgetLine");
  const note = document.getElementById("budgetNote");
  line.textContent = `${fmt.format(total)} / ${fmt.format(BUDGET_RSD)}`;

  if(total === 0){
    note.textContent = "Poruka sadrži listu proizvoda i ukupnu cenu. (Nema kartica i nema plaćanja na sajtu.)";
    return;
  }

  if(total <= BUDGET_RSD){
    note.textContent = "Super! U okviru si budžeta. To je veština kupovine.";
  } else if(total <= BUDGET_RSD * 1.15){
    note.textContent = "Malo prelazi budžet. Možeš da izbaciš 1 stvar ili smanjiš količinu.";
  } else {
    note.textContent = "Prelazi budžet. Probaj da izabereš 1–2 omiljene stvari umesto sve.";
  }
}

function eduCheckAfterAdd(){
  const total = cartTotal();
  if(total > 0 && total <= BUDGET_RSD && !state.achievements["budget_ok"]){
    awardOnce("budget_ok", "Bravo, budžet!", "U okviru si budžeta. To je veština: planiranje.");
  }
  if(total > BUDGET_RSD && !state.achievements["budget_over"]){
    awardOnce("budget_over", "Budžet alarm!", "Prešao si budžet. Nauči: izbaci 1 stvar ili smanji količinu.");
  }
  if(Object.keys(state.cart).length >= 3 && !state.achievements["mix3"]){
    awardOnce("mix3", "Kolekcionar!", "Dodao si 3 različite stvari u korpu. Sada uporedi: šta ti je najvažnije?");
  }
  // povremeno menjaj lekciju
  if(Math.random() < 0.25) nextLesson();
}

/* ===== Open/close cart ===== */
function toggleCart(open){
  const d = document.getElementById("drawer");
  const b = document.getElementById("backdrop");
  if(open){
    b.style.display="block";
    d.classList.add("open");
  } else {
    b.style.display="none";
    d.classList.remove("open");
  }
}

/* ===== Checkout ===== */
function checkout(){
  const entries = Object.entries(state.cart);
  if(!entries.length){ alert("Korpa je prazna."); return; }

  let total = 0;
  let msg = `Porudžbina (${encodeURIComponent(SHOP_NAME)})%0A%0A`;
  entries.forEach(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    total += p.price*qty;
    msg += `${encodeURIComponent(p.name)} x${qty} — ${encodeURIComponent(fmt.format(p.price))}%0A`;
  });

  msg += `%0AUkupno: ${encodeURIComponent(fmt.format(total))}%0A`;
  msg += `%0ABudžet: ${encodeURIComponent(fmt.format(BUDGET_RSD))}%0A`;

  if(total <= BUDGET_RSD){
    msg += `%0APoruka: U okviru budžeta ✅%0A`;
  } else {
    msg += `%0APoruka: Preko budžeta ⚠️ (predlog: izbaciti 1 stvar)%0A`;
  }

  msg += `%0AIME I ADRESA: (upišite ovde)`;

  const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
  window.open(url, "_blank");

  giveXP(18, "Poslao si porudžbinu roditelju");
  awardOnce("first_order", "Prva porudžbina!", "Bravo! Naučio si kako radi porudžbina i korpa.");
}

/* ===== Modal ===== */
function openModal(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;

  const bg = document.getElementById("modalBg");
  const mimg = document.getElementById("mimg");
  mimg.innerHTML = "";

  if(p.img){
    const im = document.createElement("img");
    im.src=p.img; im.alt=p.name;
    mimg.appendChild(im);
  } else {
    const ph = document.createElement("div");
    ph.className="ph";
    ph.textContent="UBACI SLIKU";
    mimg.appendChild(ph);
  }

  document.getElementById("mname").textContent = p.name;
  document.getElementById("mdesc").textContent = p.desc || "";

  const meta = document.getElementById("mmeta");
  meta.innerHTML = "";
  const rarity = p.rarity ? `Rarity: ${p.rarity}` : "Rarity: Common";
  [rarity, "Cena: "+fmt.format(p.price), "Tag: "+(p.tag||"Squishy")].forEach(t=>{
    const el=document.createElement("div");
    el.className="pill"; el.textContent=t;
    meta.appendChild(el);
  });

  const lessonsMini = [
    "Mini lekcija: Ako kupiš 2 komada, ukupno je 2 × cena.",
    "Mini lekcija: “Najjeftinije” nije uvek najbolje — važno je koliko ti znači.",
    "Mini lekcija: Napravi listu ‘želim’ i ‘treba’ — to je pametna kupovina."
  ];
  document.getElementById("mLesson").textContent = lessonsMini[Math.floor(Math.random()*lessonsMini.length)];

  document.getElementById("madd").onclick = ()=>{
    addToCart(id,1);
    giveXP(xpFor(p), `Dodao si "${p.name}" iz detalja`);
    toggleCart(true);
    closeModal();
  };

  bg.style.display="flex";
}
function closeModal(){ document.getElementById("modalBg").style.display="none"; }

/* ===== Progress UI ===== */
function updateProgressUI(){
  const need = xpNeedForLevel(state.level);
  document.getElementById("lvl").textContent = state.level;
  document.getElementById("xp").textContent = state.xp;
  document.getElementById("xpNeed").textContent = need;
  const pct = Math.max(0, Math.min(100, Math.round((state.xp/need)*100)));
  document.getElementById("barFill").style.width = pct + "%";

  const b = BADGES.slice().reverse().find(x => state.level >= x.lvl) || BADGES[0];
  document.getElementById("badgeLine").textContent = "Bedž: " + b.name;
  document.getElementById("lvlBadge").textContent = b.label;
}

function init(){
  document.getElementById("shopName").textContent = SHOP_NAME;
  document.getElementById("shopSub").textContent = SHOP_SUB;
  document.getElementById("year").textContent = new Date().getFullYear();

  // controls
  document.getElementById("q").addEventListener("input", e=>{ state.q=e.target.value; renderGrid(); });
  document.getElementById("sort").addEventListener("change", e=>{ state.sort=e.target.value; renderGrid(); });
  document.getElementById("scrollShop").onclick = ()=> document.getElementById("grid").scrollIntoView({behavior:"smooth"});

  // cart open/close
  document.getElementById("openCart").onclick = ()=>{ renderCart(); toggleCart(true); };
  document.getElementById("closeCart").onclick = ()=> toggleCart(false);
  document.getElementById("backdrop").onclick = ()=> toggleCart(false);
  document.getElementById("checkoutBtn").onclick = ()=> checkout();

  // modal close
  document.getElementById("closeModal").onclick = ()=> closeModal();
  document.getElementById("mclose2").onclick = ()=> closeModal();
  document.getElementById("modalBg").addEventListener("click", (e)=>{ if(e.target.id==="modalBg") closeModal(); });

  // initial lesson and UI
  nextLesson();
  updateBudgetUI();
  updateCartCount();
  updateProgressUI();

  renderGrid();
  renderCart();

  // welcome toast once
  if(!state.achievements["welcome"]){
    state.achievements["welcome"] = true;
    saveAll();
    toast("Dobrodošao!", "Ovo je shop-igrica: učiš korpu, budžet i račun. Dodaj nešto u korpu da dobiješ XP!", "Start");
  }
}

init();
</script>
</body>
</html>
