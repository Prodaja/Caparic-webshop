<!doctype html>
<html lang="sr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Caparicki Webshop</title>

<style>
:root{
  --bg1:#0e1028;
  --bg2:#151a44;
  --card:#1d245a;
  --accent:#7c5cff;
  --accent2:#34d399;
  --pink:#ff6bd6;
  --yellow:#ffd166;
  --text:#ffffff;
  --muted:#c9cff8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:
    radial-gradient(900px 500px at 20% -10%, rgba(124,92,255,.35), transparent 60%),
    radial-gradient(900px 500px at 80% 0%, rgba(52,211,153,.25), transparent 60%),
    radial-gradient(900px 500px at 50% 120%, rgba(255,107,214,.18), transparent 60%),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
  overflow-x:hidden;
}
.wrap{max-width:1020px;margin:auto;padding:16px}

header{
  display:flex;justify-content:space-between;align-items:center;gap:12px;
  padding:14px;border-radius:22px;
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.15);
  backdrop-filter: blur(10px);
}
header h1{margin:0;font-size:18px}
.small{font-size:12px;color:var(--muted);font-weight:800}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}

.btn{
  border:0;border-radius:14px;
  padding:10px 14px;
  font-weight:1000;
  cursor:pointer;
  transition:transform .12s ease, filter .12s ease;
}
.btn:hover{transform:translateY(-1px);filter:brightness(1.02)}
.btn-main{background:linear-gradient(135deg,var(--accent),var(--pink));color:#060a18}
.btn-green{background:linear-gradient(135deg,var(--accent2),#a6ffd8);color:#07102a}
.btn-ghost{background:rgba(255,255,255,.08);color:var(--text);border:1px solid rgba(255,255,255,.14)}

.chip{
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
  font-weight:900
}

.hero{
  margin-top:14px;
  padding:16px;
  border-radius:22px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.15);
}
.hero h2{margin:0 0 6px;font-size:22px}
.progress{
  margin-top:10px;
  padding:12px;
  border-radius:18px;
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.14);
}
.bar{
  margin-top:8px;height:12px;border-radius:999px;
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.12);
  overflow:hidden;
}
.bar i{
  display:block;height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--accent2),#4dd3ff,var(--accent));
  transition:width .2s ease;
}
.lesson{
  margin-top:10px;
  padding:12px;border-radius:18px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.12);
  color:rgba(255,255,255,.92);
  font-weight:900;
  line-height:1.35;
  font-size:12.5px;
}
.lesson b{color:#fff}
.tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.tag{
  font-size:11px;font-weight:1100;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:var(--muted)
}

.controls{
  margin-top:12px;
  display:grid;
  grid-template-columns: 1fr auto;
  gap:10px;
}
input{
  width:100%; padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:var(--text);
  font-weight:900;
}

.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
}
@media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:520px){.grid{grid-template-columns:1fr}}

.card{
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.15);
  border-radius:18px;
  overflow:hidden;
  transition:transform .15s ease, border-color .15s ease;
}
.card:hover{transform:translateY(-4px);border-color:rgba(124,92,255,.45)}
.img{
  height:170px;
  background:linear-gradient(135deg,rgba(124,92,255,.3),rgba(52,211,153,.25));
  display:flex;align-items:center;justify-content:center;
  position:relative;
}
.img img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.05) contrast(1.02)}
.badge{
  position:absolute; top:10px; left:10px;
  padding:6px 10px;border-radius:999px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.18);
  font-weight:1000; font-size:11px;
}
.ph{
  background:#fff;color:#0e1028;
  padding:8px 12px;border-radius:999px;
  font-weight:1100;
}
.c{padding:12px}
.c h3{margin:0;font-size:15px;font-weight:1200}
.desc{font-size:12.5px;color:var(--muted);margin:6px 0;line-height:1.35;font-weight:850}
.price{font-weight:1300;margin-bottom:8px}

.actions{display:flex;gap:8px}
.actions button{flex:1}

.cartBtn{
  position:fixed;right:16px;bottom:16px;
  z-index:20;
  box-shadow:0 18px 45px rgba(0,0,0,.35);
}

.cartBG{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  z-index:40;
}
.cart{
  position:absolute;right:0;top:0;
  width:92%;max-width:380px;height:100%;
  background:#0f1538;
  padding:14px;
  border-left:1px solid rgba(255,255,255,.14);
}
.item{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.04);
  border-radius:14px;
  padding:10px;
  margin:10px 0;
}
.itemTop{display:flex;justify-content:space-between;gap:10px;font-weight:1100}
.itemSmall{color:var(--muted);font-weight:900;font-size:12px;margin-top:4px}
.qty{display:flex;gap:8px;margin-top:8px}
.qbtn{
  width:32px;height:32px;border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:var(--text);font-weight:1200;cursor:pointer;
}

.footer{text-align:center;margin-top:16px;font-size:12px;color:var(--muted);font-weight:850}

/* Toast */
.toastHost{position:fixed;right:14px;bottom:86px;z-index:60;display:flex;flex-direction:column;gap:10px;pointer-events:none}
.toast{
  pointer-events:none;
  width:min(380px,92vw);
  border-radius:18px;
  padding:12px;
  background:rgba(10,14,34,.92);
  border:1px solid rgba(255,255,255,.14);
  box-shadow:0 18px 55px rgba(0,0,0,.35);
  opacity:0; transform:translateY(10px);
  animation:toastIn .22s ease forwards;
}
@keyframes toastIn{to{opacity:1;transform:translateY(0)}}
.toastTop{display:flex;justify-content:space-between;gap:10px;align-items:center}
.toastTitle{font-weight:1200}
.pill{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:var(--muted);font-weight:1100;font-size:11px}
.toastBody{margin-top:6px;color:rgba(255,255,255,.86);font-weight:900;font-size:12.5px;line-height:1.35}

/* Confetti */
.confetti{position:fixed;inset:0;pointer-events:none;z-index:80;display:none;overflow:hidden}
.confetti i{position:absolute;width:10px;height:14px;border-radius:4px;opacity:.95;animation:fall 950ms linear forwards;transform:translateY(-20px) rotate(0deg)}
@keyframes fall{to{transform:translateY(110vh) rotate(420deg);opacity:1}}
</style>
</head>

<body>
<div class="wrap">

<header>
  <div>
    <h1>Caparicki Webshop</h1>
    <div class="small">Igra ‚Ä¢ Kupovina ‚Ä¢ Uƒçenje (nema pravog plaƒáanja)</div>
  </div>
  <div class="row">
    <span class="chip">‚≠ê XP: <b id="xp">0</b></span>
    <span class="chip">üèÜ Bed≈æ: <b id="badge">Poƒçetnik</b></span>
  </div>
</header>

<section class="hero">
  <h2>Izaberi pametno üß†</h2>
  <p class="small">Dobija≈° XP kad dodaje≈°/menja≈° korpu. Cilj: uƒçi≈° bud≈æet i raƒçun (cena √ó koliƒçina).</p>

  <div class="progress">
    <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap">
      <div style="font-weight:1000">LEVEL <span id="level">1</span> ‚Ä¢ do sledeƒáeg: <span id="need">100</span> XP</div>
      <button class="btn btn-ghost" onclick="nextLesson()">Nova mini lekcija</button>
    </div>
    <div class="bar" aria-label="XP bar"><i id="barFill"></i></div>

    <div class="lesson" id="lesson">
      <b>Mini lekcija:</b> Pre kupovine pitaj se: ‚ÄúDa li mi se samo sviƒëa ili mi stvarno treba?‚Äù
      <div class="tags">
        <div class="tag">Tip: napravi bud≈æet i dr≈æi ga se</div>
        <div class="tag">Tip: uporedi 2 opcije</div>
      </div>
    </div>

    <div class="controls">
      <input id="q" placeholder="Pretraga (npr. kapibara, donut, boba)" />
      <button class="btn btn-green" onclick="document.getElementById('grid').scrollIntoView({behavior:'smooth'})">Ponuda</button>
    </div>
  </div>
</section>

<div class="grid" id="grid"></div>

<button class="btn btn-green cartBtn" onclick="openCart()">üõí Korpa (<span id="count">0</span>)</button>

<div class="cartBG" id="cartBG" onclick="if(event.target.id==='cartBG') closeCart()">
  <div class="cart">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Moja korpa</h3>
      <button class="btn btn-ghost" onclick="closeCart()">Zatvori</button>
    </div>

    <div id="cartItems"></div>

    <p style="margin:10px 0"><b>Ukupno:</b> <span id="total">0 RSD</span></p>
    <button class="btn btn-green" onclick="checkout()">Po≈°alji roditelju (Viber)</button>

    <p class="small" style="margin-top:10px" id="eduSummary"></p>
  </div>
</div>

<div class="footer">
  Edukativni webshop za decu ‚Ä¢ porud≈æbina ide roditelju kao poruka ‚Ä¢ nema pravog plaƒáanja
</div>

</div>

<div class="toastHost" id="toastHost"></div>
<div class="confetti" id="confetti"></div>

<script>
/* =========================
   EDITUJ SAMO OVO: SLIKE, CENE, OPISI
   Slike ubaci u folder img/ pa upi≈°i npr. img/kapibara.jpg
   ========================= */
const PRODUCTS = [
  {id:"kapibara", name:"Mini Kapibara", price:790,  tag:"Hit", img:"img/kapibara.jpg", desc:"Mekana kapibara za stiskanje i smirenje."},
  {id:"donut",    name:"Galaxy Donut",  price:990,  tag:"Wow", img:"img/donut.jpg",    desc:"≈†areni donut kao iz crtanog filma."},
  {id:"boba",     name:"Boba Milk Tea", price:1190, tag:"Top", img:"img/boba.jpg",     desc:"Boba ƒça≈°a ‚Äì hit meƒëu klincima."}
];

/* Edu: mali bud≈æet */
const BUDGET_RSD = 2000;
/* ========================= */

const fmt = new Intl.NumberFormat("sr-RS",{style:"currency",currency:"RSD",maximumFractionDigits:0});

let cart = load("cap_cart", {});
let xp = load("cap_xp", 0);
let level = load("cap_lvl", 1);

const LESSONS = [
  {t:"Pre kupovine pitaj se: ‚ÄúDa li mi se samo sviƒëa ili mi stvarno treba?‚Äù", tags:["Nije svaka ≈æelja potreba","Pametan izbor"]},
  {t:"Raƒçun: ukupno = cena √ó koliƒçina. To je super moƒá!", tags:["Probaj da izraƒçuna≈° u glavi","Ve≈æba matematike"]},
  {t:"Bud≈æet je plan: ako ima≈° 2.000 RSD, ne kupuje≈° za 2.500 RSD.", tags:["Izbaci 1 stvar","Smanji koliƒçinu"]},
  {t:"Popust nije magija: ako ti ne treba bez popusta, mo≈æda ti ne treba ni sa popustom.", tags:["Uporedi pre/posle","Ne kupuj impulsivno"]}
];
let lessonIndex = load("cap_lesson_i", 0);

function save(){
  localStorage.setItem("cap_cart", JSON.stringify(cart));
  localStorage.setItem("cap_xp", String(xp));
  localStorage.setItem("cap_lvl", String(level));
  localStorage.setItem("cap_lesson_i", String(lessonIndex));
}
function load(key, def){
  try{
    const raw = localStorage.getItem(key);
    if(raw===null) return def;
    return key==="cap_cart" ? JSON.parse(raw) : Number(raw);
  }catch(e){ return def; }
}

function beep(type="add"){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type="sine";
    o.frequency.value = type==="level" ? 660 : 520;
    g.gain.value = 0.08;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    o.frequency.exponentialRampToValueAtTime(type==="level"?990:740, ctx.currentTime + 0.12);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.18);
    o.stop(ctx.currentTime + 0.2);
  }catch(e){}
}

function toast(title, body, pill){
  const host = document.getElementById("toastHost");
  const t = document.createElement("div");
  t.className="toast";
  t.innerHTML = `
    <div class="toastTop">
      <div class="toastTitle">${esc(title)}</div>
      <div class="pill">${esc(pill||"Info")}</div>
    </div>
    <div class="toastBody">${esc(body)}</div>
  `;
  host.appendChild(t);
  setTimeout(()=>{ t.style.opacity="0"; t.style.transform="translateY(10px)"; }, 2600);
  setTimeout(()=>{ t.remove(); }, 3000);
}

function confetti(pieces=22){
  const c = document.getElementById("confetti");
  c.innerHTML=""; c.style.display="block";
  const colors=["#7c5cff","#34d399","#ff6bd6","#ffd166","#4dd3ff"];
  for(let i=0;i<pieces;i++){
    const p=document.createElement("i");
    p.style.left=(Math.random()*100)+"vw";
    p.style.top=(-20 - Math.random()*80)+"px";
    const size=7+Math.random()*9;
    p.style.width=size+"px"; p.style.height=(size+4)+"px";
    p.style.background=colors[Math.floor(Math.random()*colors.length)];
    p.style.animationDuration=(750+Math.random()*500)+"ms";
    p.style.animationDelay=(Math.random()*120)+"ms";
    c.appendChild(p);
  }
  setTimeout(()=>{ c.style.display="none"; c.innerHTML=""; }, 1200);
}

function esc(s){return String(s).replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));}

function xpNeed(lvl){ return Math.round(80 + lvl*40 + (lvl-1)*lvl*8); }
function badgeFor(xp){
  if(xp>=300) return "Legenda";
  if(xp>=180) return "Trgovac PRO";
  if(xp>=90)  return "Pametan kupac";
  return "Poƒçetnik";
}

function giveXP(amount, reason){
  xp += amount;

  let need = xpNeed(level);
  while(xp >= need){
    xp -= need;
    level += 1;
    beep("level");
    confetti(36);
    toast("LEVEL UP!", `Bravo! Sada si nivo ${level}.`, `Nivo ${level}`);
    need = xpNeed(level);
  }

  beep("add");
  toast("+XP", `${reason} (+${amount} XP)`, "Napredak");
  updateUI();
  save();
}

function nextLesson(){
  lessonIndex = (lessonIndex + 1) % LESSONS.length;
  const L = LESSONS[lessonIndex];
  document.getElementById("lesson").innerHTML = `
    <b>Mini lekcija:</b> ${esc(L.t)}
    <div class="tags">
      <div class="tag">${esc(L.tags[0])}</div>
      <div class="tag">${esc(L.tags[1])}</div>
    </div>
  `;
  save();
}

function filtered(){
  const q = (document.getElementById("q").value||"").trim().toLowerCase();
  if(!q) return PRODUCTS;
  return PRODUCTS.filter(p =>
    p.name.toLowerCase().includes(q) ||
    (p.desc||"").toLowerCase().includes(q) ||
    (p.tag||"").toLowerCase().includes(q)
  );
}

function render(){
  const g=document.getElementById("grid"); g.innerHTML="";
  const list = filtered();
  if(!list.length){
    g.innerHTML = `<div style="grid-column:1/-1;padding:16px;border-radius:18px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.14);font-weight:950">Nema rezultata. Probaj drugu pretragu.</div>`;
    return;
  }
  list.forEach(p=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <div class="img">
        <div class="badge">${esc(p.tag||"Squishy")}</div>
        ${p.img?`<img src="${esc(p.img)}" alt="${esc(p.name)}">`:`<div class="ph">UBACI SLIKU</div>`}
      </div>
      <div class="c">
        <h3>${esc(p.name)}</h3>
        <div class="desc">${esc(p.desc||"")}</div>
        <div class="price">${fmt.format(p.price)}</div>
        <div class="actions">
          <button class="btn btn-main" onclick="addToCart('${esc(p.id)}')">Dodaj</button>
          <button class="btn btn-ghost" onclick="showTip('${esc(p.id)}')">Tip</button>
        </div>
      </div>`;
    g.appendChild(d);
  });
}

function showTip(id){
  const p = PRODUCTS.find(x=>x.id===id);
  const tips = [
    "Pitanje: da li bi ovo kupio da nema≈° korpu? üôÇ",
    "Tip: uporedi sa jednim drugim proizvodom pa odluƒçi.",
    "Tip: ako uzme≈° 2 komada, ukupno je 2 √ó cena.",
    "Tip: najbolja kupovina je ona koja ti dugo traje."
  ];
  toast("Saveti kupovine", `${p.name}: ${tips[Math.floor(Math.random()*tips.length)]}`, "Edukacija");
}

function addToCart(id){
  cart[id]=(cart[id]||0)+1;
  giveXP(12, `Dodao si "${PRODUCTS.find(x=>x.id===id).name}" u korpu`);
  if(Math.random()<0.25) nextLesson();
  updateUI();
  save();
}

function removeFromCart(id){
  delete cart[id];
  giveXP(8, "Obrisao si proizvod ‚Äì kontrola bud≈æeta!");
  updateUI();
  save();
}

function changeQty(id,delta){
  cart[id]=(cart[id]||0)+delta;
  if(cart[id]<=0) delete cart[id];
  giveXP(delta>0?4:6, delta>0?"Poveƒáao si koliƒçinu":"Smanjio si koliƒçinu (pametan potez)");
  updateUI();
  save();
}

function cartTotal(){
  let t=0;
  Object.entries(cart).forEach(([id,q])=>{
    const p=PRODUCTS.find(x=>x.id===id);
    if(p) t+=p.price*q;
  });
  return t;
}

function updateUI(){
  const count = Object.values(cart).reduce((a,b)=>a+b,0);
  document.getElementById("count").textContent = count;

  document.getElementById("xp").textContent = xp;
  document.getElementById("level").textContent = level;
  const need = xpNeed(level);
  document.getElementById("need").textContent = need;

  const pct = Math.max(0, Math.min(100, Math.round((xp/need)*100)));
  document.getElementById("barFill").style.width = pct+"%";

  document.getElementById("badge").textContent = badgeFor(load("cap_xp",0) + xp); // vizuelno ‚Äúnapreduje‚Äù

  // Edu summary za roditelja
  const total = cartTotal();
  let edu = `Bud≈æet: ${fmt.format(total)} / ${fmt.format(BUDGET_RSD)}. `;
  if(total===0) edu += "Korpa je prazna.";
  else if(total<=BUDGET_RSD) edu += "U okviru bud≈æeta ‚úÖ (dete uƒçi planiranje).";
  else edu += "Preko bud≈æeta ‚ö†Ô∏è (predlog: izbaci 1 stvar ili smanji koliƒçinu).";
  document.getElementById("eduSummary").textContent = edu;

  // ako je korpa otvorena, osve≈æi prikaz
  if(document.getElementById("cartBG").style.display==="block"){
    renderCart();
  }
}

function renderCart(){
  const box=document.getElementById("cartItems"); box.innerHTML="";
  const entries = Object.entries(cart);
  let total=0;

  if(!entries.length){
    box.innerHTML = `<div class="item"><b>Korpa je prazna.</b><div class="itemSmall">Dodaj ne≈°to i dobija≈° XP.</div></div>`;
    document.getElementById("total").textContent = fmt.format(0);
    return;
  }

  entries.forEach(([id,q])=>{
    const p=PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    total += p.price*q;

    const el=document.createElement("div");
    el.className="item";
    el.innerHTML = `
      <div class="itemTop"><span>${esc(p.name)}</span><span>${fmt.format(p.price*q)}</span></div>
      <div class="itemSmall">${fmt.format(p.price)} √ó ${q}</div>
      <div class="qty">
        <button class="qbtn" onclick="changeQty('${esc(id)}',-1)">‚Äì</button>
        <button class="qbtn" onclick="changeQty('${esc(id)}',+1)">+</button>
        <button class="qbtn" onclick="removeFromCart('${esc(id)}')">√ó</button>
      </div>
    `;
    box.appendChild(el);
  });

  document.getElementById("total").textContent = fmt.format(total);
}

function openCart(){
  renderCart();
  document.getElementById("cartBG").style.display="block";
}
function closeCart(){
  document.getElementById("cartBG").style.display="none";
}

function checkout(){
  const entries = Object.entries(cart);
  if(!entries.length){ alert("Korpa je prazna."); return; }

  let total=0;
  let msg = `Porud≈æbina (Caparicki Webshop)%0A%0A`;
  entries.forEach(([id,q])=>{
    const p=PRODUCTS.find(x=>x.id===id);
    total += p.price*q;
    msg += `${encodeURIComponent(p.name)} x${q} ‚Äî ${encodeURIComponent(fmt.format(p.price))}%0A`;
  });

  msg += `%0AUkupno: ${encodeURIComponent(fmt.format(total))}%0A`;
  msg += `%0ABud≈æet: ${encodeURIComponent(fmt.format(BUDGET_RSD))}%0A`;
  if(total<=BUDGET_RSD) msg += `%0AStatus: U okviru bud≈æeta ‚úÖ%0A`;
  else msg += `%0AStatus: Preko bud≈æeta ‚ö†Ô∏è (predlog: izbaciti 1 stvar)%0A`;
  msg += `%0AIME I ADRESA: (upi≈°ite ovde)`;

  // Viber share/forward ‚Äì najstabilnije
  window.open(`viber://forward?text=${msg}`, "_blank");

  confetti(40);
  toast("Bravo!", "Porud≈æbina je spremna za roditelja. Nauƒçio si kako radi webshop!", "Final");
}

document.getElementById("q").addEventListener("input", ()=>render());

(function init(){
  // uƒçitaj lekciju
  const L = LESSONS[lessonIndex];
  document.getElementById("lesson").innerHTML = `
    <b>Mini lekcija:</b> ${esc(L.t)}
    <div class="tags">
      <div class="tag">${esc(L.tags[0])}</div>
      <div class="tag">${esc(L.tags[1])}</div>
    </div>
  `;

  render();
  updateUI();
  save();

  toast("Dobrodo≈°ao!", "Ovo je webshop-igrica: dodaj u korpu i skupljaj XP.", "Start");
})();
</script>
</body>
</html>
